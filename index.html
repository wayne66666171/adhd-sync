<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ADHD Sync - ADHDåŒæ­¥åŠ©æ‰‹</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§ </text></svg>">
    <style>
        :root {
            --primary: #6366F1;
            --secondary: #8B5CF6;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --border: #E2E8F0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Tab Navigation */
        .tab-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .tab-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 10px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .tab-btn.active {
            color: var(--primary);
        }

        .tab-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Main Container */
        .container {
            padding: 20px;
            padding-bottom: 80px;
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
        }

        /* Start Page */
        .start-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
            text-align: center;
            gap: 24px;
        }

        .start-icon {
            font-size: 80px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .start-page h2 {
            font-size: 28px;
            font-weight: 700;
        }

        .start-page p {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .swipe-guide {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .swipe-guide div {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            font-size: 14px;
        }

        .swipe-guide .yes { color: var(--success); }
        .swipe-guide .no { color: var(--danger); }
        .swipe-guide .skip { color: var(--warning); }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 16px 48px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        /* Card Stack */
        .card-container {
            position: relative;
            height: 420px;
            margin: 20px 0;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 480px) {
            .card-container {
                height: 380px;
            }

            .card-emoji {
                font-size: 48px;
                margin-bottom: 16px;
            }

            .card-question {
                font-size: 18px;
            }

            .card-description {
                font-size: 13px;
            }

            .swipe-indicators {
                gap: 30px;
            }

            .indicator-icon {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .severity-circle {
                width: 140px;
                height: 140px;
            }

            .summary-card {
                padding: 16px;
            }

            .symptom-tag {
                font-size: 12px;
                padding: 6px 12px;
            }
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 24px;
            text-align: center;
            cursor: grab;
            user-select: none;
            overflow: hidden;
        }

        .card.dragging {
            cursor: grabbing;
        }

        .card-emoji {
            font-size: 64px;
            margin-bottom: 24px;
        }

        .card-question {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .card-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .card-category {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 12px;
            font-weight: 500;
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            padding: 6px 12px;
            border-radius: 12px;
        }

        /* Card Overlays */
        .card-overlay {
            position: absolute;
            inset: 0;
            border-radius: 24px;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 12px;
        }

        .card-overlay.show {
            display: flex;
        }

        .card-overlay.yes {
            background: rgba(16, 185, 129, 0.3);
        }

        .card-overlay.no {
            background: rgba(239, 68, 68, 0.3);
        }

        .card-overlay.skip {
            background: rgba(245, 158, 11, 0.3);
        }

        .card-overlay.uncertain {
            background: rgba(100, 116, 139, 0.3);
        }

        .card-overlay-icon {
            font-size: 60px;
            color: white;
            font-weight: bold;
        }

        /* Progress */
        .progress-container {
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Swipe Indicators */
        .swipe-indicators {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
        }

        .indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .indicator-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .indicator-icon.no { color: var(--danger); }
        .indicator-icon.skip { color: var(--warning); }
        .indicator-icon.yes { color: var(--success); }
        .indicator-icon.uncertain { color: var(--text-secondary); }

        /* Impact Picker */
        .impact-picker {
            text-align: center;
        }

        .impact-picker h2 {
            font-size: 22px;
            margin-bottom: 32px;
        }

        .impact-option {
            display: flex;
            align-items: center;
            gap: 16px;
            background: var(--card-bg);
            padding: 20px;
            margin-bottom: 16px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .impact-option:active {
            transform: scale(0.98);
        }

        .impact-option span:first-child {
            font-size: 28px;
        }

        .impact-option span:last-child {
            font-size: 18px;
            font-weight: 500;
        }

        /* Completion */
        .completion-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
            gap: 20px;
        }

        .completion-icon {
            font-size: 80px;
        }

        .completion-page h2 {
            font-size: 28px;
            font-weight: 700;
        }

        .completion-page p {
            color: var(--text-secondary);
        }

        /* Summary Page */
        .summary-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .severity-circle {
            width: 160px;
            height: 160px;
            margin: 0 auto 20px;
            position: relative;
        }

        .severity-circle svg {
            transform: rotate(-90deg);
        }

        .severity-circle-bg {
            fill: none;
            stroke: var(--border);
            stroke-width: 12;
        }

        .severity-circle-fill {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.8s ease;
        }

        .severity-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .severity-percent {
            font-size: 36px;
            font-weight: 700;
        }

        .severity-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .summary-text {
            text-align: center;
            margin-bottom: 24px;
        }

        .summary-text h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .summary-text p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .duration-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .duration-btn {
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--card-bg);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .duration-btn.active {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }

        .symptom-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .symptom-tag {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 500;
        }

        /* Doctor Mode */
        
        
        .doctor-tip {
            background: rgba(99, 102, 241, 0.1);
            padding: 16px;
            border-radius: 12px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .diagnosis-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-left: 4px solid var(--primary);
        }
            text-align: center;
        }

        /* History */
        .history-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
            text-align: center;
            gap: 16px;
        }

        .history-empty-icon {
            font-size: 60px;
            opacity: 0.5;
        }

        .history-empty h3 {
            font-size: 20px;
        }

        .history-empty p {
            color: var(--text-secondary);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .history-item {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .history-date {
            font-weight: 700;
            font-size: 16px;
        }

        .history-severity {
            font-size: 14px;
        }

        .history-summary {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .history-symptoms {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .history-symptom {
            font-size: 12px;
            padding: 4px 10px;
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            border-radius: 8px;
        }

        .history-clear {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Settings */
        .settings-list {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
        }

        .settings-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item svg {
            width: 24px;
            height: 24px;
        }

        .settings-item.danger {
            color: var(--danger);
        }

        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section h3 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            padding-left: 16px;
        }

        .app-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .app-icon {
            font-size: 40px;
        }

        .tips-section {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
        }

        .tips-section h3 {
            font-size: 16px;
            margin-bottom: 16px;
        }

        .tip-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Alert */
        .alert {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .alert.show {
            display: flex;
        }

        .alert-content {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 20px;
            width: 80%;
            max-width: 320px;
            text-align: center;
        }

        .alert-content h3 {
            margin-bottom: 12px;
        }

        .alert-content p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-btns {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .alert-btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            border: none;
        }

        .alert-btn.cancel {
            background: var(--border);
            color: var(--text-primary);
        }

        .alert-btn.danger {
            background: var(--danger);
            color: white;
        }

        /* Animations */
        @keyframes slideOutRight {
            to { transform: translateX(500px) rotate(20deg); opacity: 0; }
        }

        @keyframes slideOutLeft {
            to { transform: translateX(-500px) rotate(-20deg); opacity: 0; }
        }

        @keyframes slideOutUp {
            to { transform: translateY(-500px); opacity: 0; }
        }

        @keyframes slideOutDown {
            to { transform: translateY(500px); opacity: 0; }
        }

        .card.slide-right {
            animation: slideOutRight 0.3s forwards;
        }

        .card.slide-left {
            animation: slideOutLeft 0.3s forwards;
        }

        .card.slide-up {
            animation: slideOutUp 0.3s forwards;
        }

        .card.slide-down {
            animation: slideOutDown 0.3s forwards;
        }
    </style>
</head>
<body>
    <!-- Tab Navigation -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="home">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/>
                <path d="M12 6v6l4 2"/>
            </svg>
            <span>è¯„ä¼°</span>
        </button>
        <button class="tab-btn" data-tab="summary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 20V10M12 20V4M6 20v-6"/>
            </svg>
            <span>æ‘˜è¦</span>
        </button>
        <button class="tab-btn" data-tab="history">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
            <span>å†å²</span>
        </button>
        <button class="tab-btn" data-tab="settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
            <span>è®¾ç½®</span>
        </button>
    </nav>

    <!-- Home Page -->
    <div id="home-page" class="page active">
        <div class="container">
            <!-- Start View -->
            <div id="start-view" class="start-page">
                <div class="start-icon">ğŸ§ </div>
                <h2>ADHD åŒæ­¥åŠ©æ‰‹</h2>
                <p>é€šè¿‡æ»‘åŠ¨å¡ç‰‡å¿«é€Ÿè®°å½•æ‚¨çš„ç—‡çŠ¶</p>

                <div class="swipe-guide">
                    <div class="yes">
                        <span>ğŸ‘‰</span> å³æ»‘ = æœ‰è¿™ä¸ªç—‡çŠ¶
                    </div>
                    <div class="no">
                        <span>ğŸ‘ˆ</span> å·¦æ»‘ = æ²¡æœ‰è¿™ä¸ªç—‡çŠ¶
                    </div>
                    <div class="skip">
                        <span>ğŸ‘†</span> ä¸Šæ»‘ = æä¸¥é‡
                    </div>
                    <div class="skip">
                        <span>ğŸ‘‡</span> ä¸‹æ»‘ = ä¸ç¡®å®š
                    </div>
                </div>

                <button class="btn-primary" onclick="startAssessment()">å¼€å§‹è¯„ä¼°</button>
            </div>

            <!-- Card View -->
            <div id="card-view" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="progress-text" class="progress-text">1 / 11</div>
                </div>

                <div class="card-container" id="card-stack">
                    <!-- Cards will be generated by JS -->
                </div>

                <div class="swipe-indicators">
                    <div class="indicator">
                        <div class="indicator-icon no">âœ•</div>
                        <span>æ²¡æœ‰</span>
                    </div>
                    <div class="indicator">
                        <div class="indicator-icon skip">â†‘</div>
                        <span>æä¸¥é‡</span>
                    </div>
                    <div class="indicator">
                        <div class="indicator-icon uncertain">â†“</div>
                        <span>ä¸ç¡®å®š</span>
                    </div>
                    <div class="indicator">
                        <div class="indicator-icon yes">â™¥</div>
                        <span>æœ‰</span>
                    </div>
                </div>
            </div>

            <!-- Impact Picker View -->
            <div id="impact-view" style="display: none;" class="impact-picker">
                <div style="font-size: 64px; margin-bottom: 24px;">ğŸ“Š</div>
                <h2>è¿™äº›é—®é¢˜å¯¹ä½ çš„ç”Ÿæ´»å½±å“æœ‰å¤šå¤§ï¼Ÿ</h2>

                <div class="impact-option" onclick="selectImpact('mild')">
                    <span>ğŸŸ¢</span>
                    <span>è½»å¾®</span>
                </div>
                <div class="impact-option" onclick="selectImpact('moderate')">
                    <span>ğŸŸ¡</span>
                    <span>ä¸­ç­‰</span>
                </div>
                <div class="impact-option" onclick="selectImpact('severe')">
                    <span>ğŸŸ </span>
                    <span>ä¸¥é‡</span>
                </div>
                <div class="impact-option" onclick="selectImpact('verySevere')">
                    <span>ğŸ”´</span>
                    <span>æä¸¥é‡</span>
                </div>
            </div>

            <!-- Completion View -->
            <div id="completion-view" style="display: none;" class="completion-page">
                <div class="completion-icon">âœ“</div>
                <h2>è¯„ä¼°å®Œæˆï¼</h2>
                <p>æ­£åœ¨ç”Ÿæˆæ‚¨çš„è¯„ä¼°æŠ¥å‘Š...</p>
            </div>
        </div>
    </div>

    <!-- Summary Page -->
    <div id="summary-page" class="page">
        <div class="container">
            <div class="header">
                <h1>è¯„ä¼°æŠ¥å‘Š</h1>
            </div>

            <div id="summary-content">
                <!-- Content will be generated by JS -->
            </div>

            
    <!-- History Page -->
    <div id="history-page" class="page">
        <div class="container">
            <div class="header">
                <h1>å†å²è®°å½•</h1>
            </div>
            <div id="history-content">
                <!-- Content will be generated by JS -->
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settings-page" class="page">
        <div class="container">
            <div class="header">
                <h1>è®¾ç½®</h1>
            </div>

            <div class="settings-section">
                <h3>æ•°æ®</h3>
                <div class="settings-list">
                    <div class="settings-item danger" onclick="confirmReset()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1,4 1,10 7,10"/>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                        </svg>
                        <span>é‡ç½®æ‰€æœ‰æ•°æ®</span>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>å…³äº</h3>
                <div class="app-info">
                    <span class="app-icon">ğŸ§ </span>
                    <div>
                        <div style="font-weight: 600;">ADHD åŒæ­¥åŠ©æ‰‹</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">v1.0.0</div>
                    </div>
                </div>
                <div class="settings-list">
                    <div class="settings-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                        <span>ä¸ºADHDæ‚£è€…è®¾è®¡</span>
                    </div>
                </div>
            </div>

            <div class="tips-section">
                <h3>ä½¿ç”¨æç¤º</h3>
                <div class="tip-row">ğŸ‘‰ å³æ»‘è¡¨ç¤ºæœ‰è¿™ä¸ªç—‡çŠ¶</div>
                <div class="tip-row">ğŸ‘ˆ å·¦æ»‘è¡¨ç¤ºæ²¡æœ‰è¿™ä¸ªç—‡çŠ¶</div>
                <div class="tip-row">ğŸ‘† ä¸Šæ»‘è¡¨ç¤ºæä¸¥é‡</div>
                <div class="tip-row">ğŸ‘‡ ä¸‹æ»‘è¡¨ç¤ºä¸ç¡®å®š</div>
            </div>
        </div>
    </div>

    <!-- Alert -->
    <div id="alert" class="alert">
        <div class="alert-content">
            <h3 id="alert-title">æç¤º</h3>
            <p id="alert-message">æ¶ˆæ¯å†…å®¹</p>
            <div class="alert-btns">
                <button class="alert-btn cancel" onclick="closeAlert()">å–æ¶ˆ</button>
                <button class="alert-btn danger" id="alert-confirm" onclick="alertCallback()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== Data ====================
        const questions = [
            // ==================== DSM-5 æ³¨æ„åŠ›ä¸é›†ä¸­ç—‡çŠ¶ (9é¡¹) ====================
            { id: 1, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ”', question: 'åœ¨å·¥ä½œæˆ–æ´»åŠ¨ä¸­ç»å¸¸å¿½ç•¥ç»†èŠ‚ï¼ŒçŠ¯ç²—å¿ƒçš„é”™è¯¯ï¼Ÿ', desc: 'å¦‚æ ¡å¯¹æ–‡æ¡£æ—¶é—æ¼é”™è¯¯' },
            { id: 2, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ¯', question: 'å®Œæˆä»»åŠ¡æˆ–æ´»åŠ¨æ—¶ç»å¸¸æœ‰å›°éš¾ï¼Ÿ', desc: 'éš¾ä»¥ä¿æŒä¸“æ³¨ï¼Œå®¹æ˜“èµ°ç¥' },
            { id: 3, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ‘‚', question: 'å½“ä½ ç›´æ¥å¯¹ä½ è¯´è¯æ—¶ï¼Œä½ ç»å¸¸åƒæ²¡å¬è§ï¼Ÿ', desc: 'ä¼¼ä¹å¿ƒä¸åœ¨ç„‰' },
            { id: 4, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ“‹', question: 'ç»å¸¸ä¸æŒ‰ç…§æŒ‡ç¤ºå®Œæˆä»»åŠ¡ï¼Ÿ', desc: 'å¼€å§‹åšä½†ä¸èƒ½å®Œæˆ' },
            { id: 5, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ“', question: 'ç»å¸¸åœ¨ç»„ç»‡ä»»åŠ¡æˆ–æ´»åŠ¨æ—¶æœ‰å›°éš¾ï¼Ÿ', desc: 'ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹' },
            { id: 6, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ˜´', question: 'ç»å¸¸é€ƒé¿æˆ–ä¸å–œæ¬¢éœ€è¦æŒç»­è„‘åŠ›åŠªåŠ›çš„ä»»åŠ¡ï¼Ÿ', desc: 'å¦‚åšä½œä¸šã€å‡†å¤‡æŠ¥å‘Š' },
            { id: 7, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ”‘', question: 'ç»å¸¸ä¸¢å¤±å·¥ä½œæˆ–æ´»åŠ¨æ‰€éœ€çš„ä¸œè¥¿ï¼Ÿ', desc: 'å¦‚å·¥å…·ã€é’±åŒ…ã€é’¥åŒ™ã€æ‰‹æœº' },
            { id: 8, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ’­', question: 'ç»å¸¸è¢«å¤–ç•Œçš„åˆºæ¿€åˆ†å¿ƒï¼Ÿ', desc: 'å¾ˆå®¹æ˜“è¢«å™ªéŸ³ã€è§†è§‰åˆºæ¿€åˆ†æ•£æ³¨æ„åŠ›' },
            { id: 9, category: 'æ³¨æ„åŠ›ä¸é›†ä¸­', emoji: 'ğŸ“…', question: 'åœ¨æ—¥å¸¸æ´»åŠ¨ä¸­ç»å¸¸å¥å¿˜ï¼Ÿ', desc: 'å¿˜è®°çº¦ä¼šã€æœè¯ã€æ‰“ç”µè¯' },

            // ==================== DSM-5 å¤šåŠ¨-å†²åŠ¨ç—‡çŠ¶ (9é¡¹) ====================
            { id: 10, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'ğŸ¦µ', question: 'ç»å¸¸æ‰‹è„šä¸åœæŠ–åŠ¨æˆ–è •åŠ¨ï¼Ÿ', desc: 'åç€æ—¶ç»å¸¸æŠ–è…¿ã€æ‘‡æ™ƒ' },
            { id: 11, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'ğŸª‘', question: 'åœ¨éœ€è¦ä¿æŒåå§¿çš„åœºåˆç»å¸¸ç¦»å¼€åº§ä½ï¼Ÿ', desc: 'ä¼šè®®ä¸­ã€åƒé¥­æ—¶ç»å¸¸ç«™èµ·æ¥' },
            { id: 12, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'ğŸƒ', question: 'ç»å¸¸åœ¨ä¸é€‚å½“çš„åœºåˆè·‘æˆ–çˆ¬ï¼Ÿ', desc: 'æˆäººå¯èƒ½è¡¨ç°ä¸ºåç«‹ä¸å®‰' },
            { id: 13, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'ğŸ¤«', question: 'ç»å¸¸éš¾ä»¥å®‰é™åœ°å‚ä¸ä¼‘é—²æ´»åŠ¨ï¼Ÿ', desc: 'å¾ˆéš¾å®‰é™åœ°çœ‹å‰§ã€çœ‹ä¹¦' },
            { id: 14, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'ğŸš€', question: 'ç»å¸¸æ„Ÿè§‰åƒè¢«é©¬è¾¾é©±åŠ¨ï¼Œåœä¸ä¸‹æ¥ï¼Ÿ', desc: 'æ€»æ˜¯å¾ˆå¿™ï¼Œæ— æ³•æ”¾æ¾' },
            { id: 15, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'ğŸ’¬', question: 'ç»å¸¸è¯´è¯è¿‡å¤šï¼Ÿ', desc: 'æ¯”å…¶ä»–äººè¯´å¾—æ›´å¤š' },
            { id: 16, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'âœ‹', question: 'ç»å¸¸åœ¨é—®é¢˜å®Œæˆå‰å°±è„±å£è€Œå‡ºç­”æ¡ˆï¼Ÿ', desc: 'ä¸ç­‰åˆ«äººè¯´å®Œå°±æŠ¢ç­”' },
            { id: 17, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'â³', question: 'ç»å¸¸éš¾ä»¥ç­‰å¾…è½®åˆ°è‡ªå·±ï¼Ÿ', desc: 'æ’é˜Ÿæ—¶ä¸è€çƒ¦' },
            { id: 18, category: 'å¤šåŠ¨-å†²åŠ¨', emoji: 'ğŸ—£ï¸', question: 'ç»å¸¸æ‰“æ–­æˆ–æ’å…¥åˆ«äººçš„æ´»åŠ¨ï¼Ÿ', desc: 'ç­‰ä¸åŠåˆ«äººè¯´å®Œå°±æ’è¯' },

            // ==================== ç—…ç¨‹è¦æ±‚ (2é¡¹) ====================
            { id: 19, category: 'ç—…ç¨‹è¦æ±‚', emoji: 'ğŸ“†', question: 'è¿™äº›æ³¨æ„åŠ›æˆ–å¤šåŠ¨/å†²åŠ¨ç—‡çŠ¶æŒç»­äº†6ä¸ªæœˆä»¥ä¸Šï¼Ÿ', desc: 'ç—‡çŠ¶ä¸æ˜¯å¶å°”å‡ºç°' },
            { id: 20, category: 'ç—…ç¨‹è¦æ±‚', emoji: 'ğŸ‘¶', question: 'è¿™äº›ç—‡çŠ¶åœ¨12å²ä¹‹å‰å°±å‡ºç°äº†ï¼Ÿ', desc: 'DSM-5è¦æ±‚ç—‡çŠ¶åœ¨ç«¥å¹´æ—©æœŸå‡ºç°' },

            // ==================== åŠŸèƒ½æŸå®³ (4é¡¹) ====================
            { id: 21, category: 'åŠŸèƒ½æŸå®³', emoji: 'ğŸ’¼', question: 'è¿™äº›ç—‡çŠ¶å½±å“äº†ä½ çš„å·¥ä½œæˆ–å­¦ä¹ è¡¨ç°ï¼Ÿ', desc: 'å¦‚å·¥ä½œæ•ˆç‡ä½ã€ç»å¸¸å‡ºé”™' },
            { id: 22, category: 'åŠŸèƒ½æŸå®³', emoji: 'ğŸ‘¥', question: 'è¿™äº›ç—‡çŠ¶å½±å“äº†ä½ çš„ç¤¾äº¤å…³ç³»ï¼Ÿ', desc: 'å¦‚ä¸äººå†²çªã€æœ‹å‹å‡å°‘' },
            { id: 23, category: 'åŠŸèƒ½æŸå®³', emoji: 'ğŸš—', question: 'è¿™äº›ç—‡çŠ¶å½±å“äº†ä½ çš„å®‰å…¨ï¼Ÿ', desc: 'å¦‚å¼€è½¦æ—¶åˆ†å¿ƒã€è¿ç« ' },
            { id: 24, category: 'åŠŸèƒ½æŸå®³', emoji: 'ğŸ“‰', question: 'è¿™äº›ç—‡çŠ¶æ˜æ˜¾é™ä½äº†ç”Ÿæ´»è´¨é‡ï¼Ÿ', desc: 'å¦‚å½±å“è‡ªæˆ‘æ•ˆèƒ½æ„Ÿ' },

            // ==================== å®¶æ—å² (4é¡¹) ====================
            { id: 25, category: 'å®¶æ—å²', emoji: 'ğŸ‘¨', question: 'ä½ çš„çˆ¶äº²æˆ–ç”Ÿçˆ¶äº²å±æœ‰ADHDæˆ–ç±»ä¼¼ç—‡çŠ¶ï¼Ÿ', desc: 'åŒ…æ‹¬æ³¨æ„åŠ›é—®é¢˜ã€å¤šåŠ¨ã€å†²åŠ¨' },
            { id: 26, category: 'å®¶æ—å²', emoji: 'ğŸ‘©', question: 'ä½ çš„æ¯äº²æˆ–ç”Ÿæ¯äº²å±æœ‰ADHDæˆ–ç±»ä¼¼ç—‡çŠ¶ï¼Ÿ', desc: 'åŒ…æ‹¬æ³¨æ„åŠ›é—®é¢˜ã€å¤šåŠ¨ã€å†²åŠ¨' },
            { id: 27, category: 'å®¶æ—å²', emoji: 'ğŸ‘´', question: 'ä½ çš„ç¥–çˆ¶æ¯æˆ–å¤–ç¥–çˆ¶æ¯æœ‰ADHDæˆ–ç±»ä¼¼ç—‡çŠ¶ï¼Ÿ', desc: 'åŒ…æ‹¬æ³¨æ„åŠ›é—®é¢˜ã€å¤šåŠ¨ã€å†²åŠ¨' },
            { id: 28, category: 'å®¶æ—å²', emoji: 'ğŸ‘¶', question: 'ä½ çš„ç›´ç³»äº²å±æœ‰æ— ADHDè¯Šæ–­ï¼Ÿ', desc: 'åŒ…æ‹¬å…„å¼Ÿå§å¦¹' },

            // ==================== æˆäººADHDç‰¹æœ‰è¡¨ç° (8é¡¹) ====================
            { id: 29, category: 'æˆäººè¡¨ç°', emoji: 'ğŸ§ ', question: 'ç»å¸¸æœ‰å†…å¿ƒåç«‹ä¸å®‰çš„æ„Ÿè§‰ï¼Ÿ', desc: 'æˆäººå¤šåŠ¨å¯èƒ½è¡¨ç°ä¸ºå†…åœ¨çš„ä¸å®‰' },
            { id: 30, category: 'æˆäººè¡¨ç°', emoji: 'ğŸ›’', question: 'ç»å¸¸å†²åŠ¨è´­ç‰©æˆ–è¿‡åº¦æ¶ˆè´¹ï¼Ÿ', desc: 'ä¹°å®Œååˆåæ‚”' },
            { id: 31, category: 'æˆäººè¡¨ç°', emoji: 'ğŸ½ï¸', question: 'ç»å¸¸åœ¨ç­‰å¾…æ—¶æ„Ÿåˆ°æåº¦ä¸è€çƒ¦ï¼Ÿ', desc: 'å¦‚æ’é˜Ÿã€ç­‰äºº' },
            { id: 32, category: 'æˆäººè¡¨ç°', emoji: 'ğŸ˜¤', question: 'å®¹æ˜“å› ä¸ºå°äº‹å°±æƒ…ç»ªå¤±æ§ï¼Ÿ', desc: 'è„¾æ°”æš´èºã€æ˜“æ€’' },
            { id: 33, category: 'æˆäººè¡¨ç°', emoji: 'â°', question: 'ç»å¸¸ä½ä¼°å®Œæˆä»»åŠ¡æ‰€éœ€çš„æ—¶é—´ï¼Ÿ', desc: 'æ€»æ˜¯ä»¥ä¸ºå¾ˆå¿«èƒ½å®Œæˆ' },
            { id: 34, category: 'æˆäººè¡¨ç°', emoji: 'ğŸ“±', question: 'ç»å¸¸åœ¨äº¤è°ˆä¸­èµ°ç¥ï¼Œçœ‹èµ·æ¥åœ¨ç©æ‰‹æœºï¼Ÿ', desc: 'å®é™…ä¸Šå¹¶æ²¡æœ‰çœ‹' },
            { id: 35, category: 'æˆäººè¡¨ç°', emoji: 'ğŸ’³', question: 'ç»å¸¸æœ‰è´¢åŠ¡é—®é¢˜ï¼Œå¦‚å€ºåŠ¡ã€è¿‡åº¦æ¶ˆè´¹ï¼Ÿ', desc: 'ä¸ç®¡ç†é‡‘é’±å›°éš¾ç›¸å…³' },
            { id: 36, category: 'æˆäººè¡¨ç°', emoji: 'ğŸš—', question: 'å¼€è½¦æ—¶ç»å¸¸è¶…é€Ÿæˆ–å®¹æ˜“å‡ºäº‹æ•…ï¼Ÿ', desc: 'ä¸å†²åŠ¨å’Œæ³¨æ„åŠ›é—®é¢˜ç›¸å…³' },

            // ==================== å…±ç—…ç­›æŸ¥ (8é¡¹) ====================
            { id: 37, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸ˜°', question: 'ä½ ç»å¸¸æ„Ÿåˆ°ç„¦è™‘æˆ–æ‹…å¿ƒå¾ˆå¤šäº‹æƒ…ï¼Ÿ', desc: 'å¹¿æ³›æ€§ç„¦è™‘ç­›æŸ¥' },
            { id: 38, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸ˜¢', question: 'ä½ ç»å¸¸æ„Ÿåˆ°å¿ƒæƒ…ä½è½æˆ–å¯¹äº‹ç‰©å¤±å»å…´è¶£ï¼Ÿ', desc: 'æŠ‘éƒç—‡ç­›æŸ¥' },
            { id: 39, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸ˜´', question: 'ä½ ç»å¸¸éš¾ä»¥å…¥ç¡æˆ–ç¡çœ å¾ˆå·®ï¼Ÿ', desc: 'ç¡çœ é—®é¢˜ç­›æŸ¥' },
            { id: 40, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸº', question: 'ä½ æ›¾ç»æœ‰è¿‡é‡é¥®é…’æˆ–ä½¿ç”¨ç‰©è´¨çš„æƒ…å†µï¼Ÿ', desc: 'ç‰©è´¨ä½¿ç”¨ç­›æŸ¥' },
            { id: 41, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸ®', question: 'ä½ ç»å¸¸éš¾ä»¥æ§åˆ¶ä¸Šç½‘æˆ–ç©æ¸¸æˆçš„æ—¶é—´ï¼Ÿ', desc: 'è¡Œä¸ºæˆç˜¾ç­›æŸ¥' },
            { id: 42, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸ’”', question: 'ä½ åœ¨äº²å¯†å…³ç³»ä¸­ç»å¸¸æ„Ÿåˆ°å›°éš¾ï¼Ÿ', desc: 'å…³ç³»åŠŸèƒ½ç­›æŸ¥' },
            { id: 43, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸ¯', question: 'ä½ ç»å¸¸éš¾ä»¥åšæŒå®Œæˆé•¿æœŸç›®æ ‡ï¼Ÿ', desc: 'æ‰§è¡ŒåŠŸèƒ½ç­›æŸ¥' },
            { id: 44, category: 'å…±ç—…ç­›æŸ¥', emoji: 'ğŸ“', question: 'ä½ ç»å¸¸åœ¨è®¡åˆ’å’Œç»„ç»‡æ–¹é¢æœ‰å›°éš¾ï¼Ÿ', desc: 'ç»„ç»‡èƒ½åŠ›ç­›æŸ¥' },

            // ==================== æ’é™¤æ€§é—®é¢˜ (5é¡¹) ====================
            { id: 45, category: 'æ’é™¤æ ‡å‡†', emoji: 'ğŸ˜´', question: 'ä½ çš„ç—‡çŠ¶ä¸»è¦åœ¨ç¡çœ ä¸è¶³æˆ–èº«ä½“ç–²åŠ³æ—¶å‡ºç°ï¼Ÿ', desc: 'æ’é™¤å…¶ä»–åŸå› ' },
            { id: 46, category: 'æ’é™¤æ ‡å‡†', emoji: 'ğŸ¤’', question: 'ä½ çš„ç—‡çŠ¶ä¸æ˜¯ç”±äºç”²çŠ¶è…ºé—®é¢˜æˆ–å…¶ä»–èº«ä½“ç–¾ç—…ï¼Ÿ', desc: 'æ’é™¤èº«ä½“ç–¾ç—…' },
            { id: 47, category: 'æ’é™¤æ ‡å‡†', emoji: 'ğŸ’Š', question: 'ä½ çš„ç—‡çŠ¶ä¸æ˜¯ç”±äºæœç”¨è¯ç‰©æˆ–ç‰©è´¨çš„å½±å“ï¼Ÿ', desc: 'æ’é™¤è¯ç‰©å› ç´ ' },
            { id: 48, category: 'æ’é™¤æ ‡å‡†', emoji: 'ğŸ˜”', question: 'ä½ çš„ç—‡çŠ¶ä¸ç¬¦åˆæŠ‘éƒç—‡æˆ–ç„¦è™‘ç—‡çš„ä¸»è¦è¯Šæ–­ï¼Ÿ', desc: 'æ’é™¤å…¶ä»–ç²¾ç¥éšœç¢' },
            { id: 49, category: 'æ’é™¤æ ‡å‡†', emoji: 'ğŸ˜±', question: 'ä½ çš„ç—‡çŠ¶ä¸æ˜¯ä¸»è¦ç”±äºåˆ›ä¼¤äº‹ä»¶æˆ–å‹åŠ›ï¼Ÿ', desc: 'æ’é™¤åˆ›ä¼¤ååº”æ¿€' },

            // ==================== å½±å“ç¨‹åº¦ (1é¡¹) ====================
            { id: 50, category: 'å½±å“ç¨‹åº¦', emoji: 'ğŸ“Š', question: 'è¿™äº›é—®é¢˜å¯¹ä½ çš„ç”Ÿæ´»å½±å“æœ‰å¤šå¤§ï¼Ÿ', desc: 'é€‰æ‹©æœ€ç¬¦åˆä½ æƒ…å†µçš„é€‰é¡¹' }
        ];

        const categoryEmojis = {
            'æ³¨æ„åŠ›ä¸é›†ä¸­': 'ğŸ”',
            'å¤šåŠ¨-å†²åŠ¨': 'âš¡',
            'ç—…ç¨‹è¦æ±‚': 'ğŸ“†',
            'åŠŸèƒ½æŸå®³': 'ğŸ’¼',
            'å®¶æ—å²': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§',
            'æˆäººè¡¨ç°': 'ğŸ§‘',
            'å…±ç—…ç­›æŸ¥': 'ğŸ¥',
            'æ’é™¤æ ‡å‡†': 'âŒ',
            'å½±å“ç¨‹åº¦': 'ğŸ“Š'
        };

        const impactLevels = {
            'mild': { text: 'è½»å¾®', emoji: 'ğŸŸ¢', value: 1 },
            'moderate': { text: 'ä¸­ç­‰', emoji: 'ğŸŸ¡', value: 2 },
            'severe': { text: 'ä¸¥é‡', emoji: 'ğŸŸ ', value: 3 },
            'verySevere': { text: 'æä¸¥é‡', emoji: 'ğŸ”´', value: 4 }
        };

        const durations = [
            { id: 'oneMonth', text: 'æœ€è¿‘1ä¸ªæœˆ', emoji: 'ğŸ“…' },
            { id: 'threeMonths', text: 'æœ€è¿‘3ä¸ªæœˆ', emoji: 'ğŸ“†' },
            { id: 'sixMonthsPlus', text: 'åŠå¹´ä»¥ä¸Š', emoji: 'ğŸ—“ï¸' }
        ];

        // ==================== State ====================
        let currentIndex = 0;
        let responses = {};
        let impactLevel = null;
        let isDoctorMode = false;
        let selectedDuration = 'threeMonths';
        let currentCard = null;
        let startX, startY;

        // ==================== Storage ====================
        function saveRecords(records) {
            localStorage.setItem('adhd_records', JSON.stringify(records));
        }

        function loadRecords() {
            const data = localStorage.getItem('adhd_records');
            return data ? JSON.parse(data) : [];
        }

        function addRecord(record) {
            const records = loadRecords();
            records.unshift(record);
            saveRecords(records);
        }

        // ==================== Tab Navigation ====================
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                switchTab(tab);
            });
        });

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`${tab}-page`).classList.add('active');

            if (tab === 'summary') renderSummary();
            if (tab === 'history') renderHistory();
        }

        // ==================== Assessment ====================
        function startAssessment() {
            currentIndex = 0;
            responses = {};
            impactLevel = null;

            document.getElementById('start-view').style.display = 'none';
            document.getElementById('card-view').style.display = 'block';

            renderCards();
        }

        function renderCards() {
            const stack = document.getElementById('card-stack');
            stack.innerHTML = '';

            // Show up to 3 cards
            for (let i = Math.min(2, questions.length - currentIndex - 1); i >= 0; i--) {
                const qIndex = currentIndex + i;
                if (qIndex < questions.length) {
                    const q = questions[qIndex];
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.style.zIndex = 10 - i;
                    card.style.transform = `scale(${1 - i * 0.05}) translateY(${-i * 10}px)`;
                    card.style.opacity = i === 0 ? 1 : 0.8;

                    if (i === 0) {
                        card.innerHTML = `
                            <span class="card-category">${q.category}</span>
                            <div class="card-emoji">${q.emoji}</div>
                            <div class="card-question">${q.question}</div>
                            ${q.desc ? `<div class="card-description">${q.desc}</div>` : ''}
                            <div class="card-overlay yes"><span class="card-overlay-icon">â™¥ æœ‰</span></div>
                            <div class="card-overlay no"><span class="card-overlay-icon">âœ• æ²¡æœ‰</span></div>
                            <div class="card-overlay skip"><span class="card-overlay-icon">â†‘ æä¸¥é‡</span></div>
                            <div class="card-overlay uncertain"><span class="card-overlay-icon">â†“ ä¸ç¡®å®š</span></div>
                        `;
                        setupDrag(card);
                        currentCard = card;
                    } else {
                        card.innerHTML = `
                            <span class="card-category">${q.category}</span>
                            <div class="card-emoji">${q.emoji}</div>
                            <div class="card-question">${q.question}</div>
                            ${q.desc ? `<div class="card-description">${q.desc}</div>` : ''}
                        `;
                    }

                    stack.appendChild(card);
                }
            }

            updateProgress();
        }

        function setupDrag(card) {
            let isDragging = false;
            let startX, startY, currentX = 0, currentY = 0;

            card.addEventListener('mousedown', start);
            card.addEventListener('touchstart', start, { passive: false });

            function start(e) {
                e.preventDefault();
                isDragging = true;
                card.classList.add('dragging');

                const point = e.touches ? e.touches[0] : e;
                startX = point.clientX;
                startY = point.clientY;

                document.addEventListener('mousemove', move);
                document.addEventListener('touchmove', move, { passive: false });
                document.addEventListener('mouseup', end);
                document.addEventListener('touchend', end);
            }

            function move(e) {
                if (!isDragging) return;
                e.preventDefault();

                const point = e.touches ? e.touches[0] : e;
                currentX = point.clientX - startX;
                currentY = point.clientY - startY;

                const rotation = currentX / 20;
                card.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${rotation}deg)`;

                // Show overlay
                const overlayYes = card.querySelector('.card-overlay.yes');
                const overlayNo = card.querySelector('.card-overlay.no');
                const overlaySkip = card.querySelector('.card-overlay.skip');
                const overlayUncertain = card.querySelector('.card-overlay.uncertain');

                overlayYes.classList.remove('show');
                overlayNo.classList.remove('show');
                overlaySkip.classList.remove('show');
                overlayUncertain.classList.remove('show');

                if (currentX > 50) {
                    overlayYes.classList.add('show');
                } else if (currentX < -50) {
                    overlayNo.classList.add('show');
                } else if (currentY < -50) {
                    overlaySkip.classList.add('show');
                } else if (currentY > 50) {
                    overlayUncertain.classList.add('show');
                }
            }

            function end() {
                if (!isDragging) return;
                isDragging = false;
                card.classList.remove('dragging');

                document.removeEventListener('mousemove', move);
                document.removeEventListener('touchmove', move);
                document.removeEventListener('mouseup', end);
                document.removeEventListener('touchend', end);

                // Determine swipe direction
                if (currentX > 100 || (currentX > 30 && Math.abs(currentY) < 50)) {
                    swipe('right');
                } else if (currentX < -100 || (currentX < -30 && Math.abs(currentY) < 50)) {
                    swipe('left');
                } else if (currentY < -80) {
                    swipe('up');
                } else if (currentY > 80) {
                    swipe('down');
                } else {
                    // Reset position
                    card.style.transition = 'transform 0.3s';
                    card.style.transform = 'translate(0, 0) rotate(0deg)';
                    setTimeout(() => card.style.transition = '', 300);
                }
            }
        }

        function swipe(direction) {
            if (!currentCard) return;

            const q = questions[currentIndex];
            responses[q.id] = direction;

            // Animate card out
            currentCard.classList.add(`slide-${direction}`);

            setTimeout(() => {
                currentIndex++;
                updateProgress();

                if (currentIndex >= questions.length - 1) {
                    // Show impact picker
                    showImpactPicker();
                } else {
                    renderCards();
                }
            }, 300);
        }

        function updateProgress() {
            const progress = ((currentIndex) / questions.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${currentIndex + 1} / ${questions.length}`;
        }

        function showImpactPicker() {
            document.getElementById('card-view').style.display = 'none';
            document.getElementById('impact-view').style.display = 'block';
        }

        function selectImpact(level) {
            impactLevel = level;
            completeAssessment();
        }

        function completeAssessment() {
            document.getElementById('impact-view').style.display = 'none';
            document.getElementById('completion-view').style.display = 'flex';

            // Calculate results
            const symptoms = calculateSymptoms();
            const severity = calculateSeverity();
            const summary = generateSummary(symptoms);

            // DSM-5 è¯Šæ–­
            const diagnosis = diagnoseADHD();

            const record = {
                id: Date.now(),
                date: new Date().toISOString(),
                symptoms: symptoms,
                severity: severity,
                summary: summary,
                duration: selectedDuration,
                diagnosis: diagnosis
            };

            addRecord(record);

            setTimeout(() => {
                switchTab('summary');
                resetAssessment();
            }, 1500);
        }

        function calculateSymptoms() {
            const symptomCategories = {};

            questions.forEach(q => {
                if (q.category === 'å½±å“ç¨‹åº¦') return;

                const response = responses[q.id];
                // Count both right (yes) and up (very severe) as symptoms
                if (response === 'right' || response === 'up') {
                    if (!symptomCategories[q.category]) {
                        symptomCategories[q.category] = { category: q.category, count: 0 };
                    }
                    // Up swipe counts as 2 for severity
                    symptomCategories[q.category].count += (response === 'up' ? 2 : 1);
                }
            });

            // Convert to array and sort
            const symptoms = Object.values(symptomCategories)
                .filter(s => s.count > 0)
                .sort((a, b) => b.count - a.count)
                .map(s => ({
                    name: s.category,
                    emoji: categoryEmojis[s.category],
                    category: s.category
                }));

            return symptoms;
        }

        function calculateSeverity() {
            // Count "yes" responses (right swipes)
            const yesCount = Object.values(responses).filter(r => r === 'right').length;
            // Count "very severe" responses (up swipes) - weight 2
            const verySevereCount = Object.values(responses).filter(r => r === 'up').length;
            // Total weighted yes count (up swipe counts as 2)
            const weightedYes = yesCount + (verySevereCount * 2);
            // Get impact level value (default to 1 if not set)
            const impactValue = impactLevels[impactLevel]?.value || 1;

            // Calculate score based on weighted yes ratio and impact
            const totalQuestions = 50;
            if (weightedYes === 0 && impactValue === 1) return 0;

            // Score = (yes ratio * 8) + impact level, max 10
            const yesRatio = weightedYes / 50; // 50 total questions
            const score = Math.min(10, Math.round((yesRatio * 8) + impactValue));

            return score;
        }

        function generateSummary(symptoms) {
            if (symptoms.length === 0) {
                return 'æœªå‘ç°æ˜æ˜¾ADHDç—‡çŠ¶';
            }

            const topSymptoms = symptoms.slice(0, 3);
            const names = topSymptoms.map(s => s.name).join('å’Œ');

            return `æ‚£è€…ä¸»è¦è¡¨ç°ä¸º${names}`;
        }

        // ==================== DSM-5 è¯Šæ–­é€»è¾‘ ====================
        function diagnoseADHD() {
            const diagnosis = {
                inattentiveScore: 0,      // æ³¨æ„åŠ›ä¸é›†ä¸­å¾—åˆ†
                hyperactiveScore: 0,        // å¤šåŠ¨-å†²åŠ¨å¾—åˆ†
                durationMet: false,        // ç—…ç¨‹è¦æ±‚
                onsetMet: false,           // 12å²å‰å‡ºç°
                impairment: 0,             // åŠŸèƒ½æŸå®³
                familyHistory: 0,           // å®¶æ—å²
                comorbidities: [],          // å…±ç—…
                exclusionsMet: true,        // æ’é™¤æ ‡å‡†
                subtype: null,              // äºšå‹
                confidence: 0,             // åŒ¹é…åº¦
                report: ''                 // è¯¦ç»†æŠ¥å‘Š
            };

            // ç»Ÿè®¡å„åˆ†ç±»å¾—åˆ†
            let categoryScores = {};

            questions.forEach(q => {
                const response = responses[q.id];
                if (response === 'right' || response === 'up') {
                    const weight = response === 'up' ? 2 : 1;

                    if (!categoryScores[q.category]) {
                        categoryScores[q.category] = 0;
                    }
                    categoryScores[q.category] += weight;

                    // DSM-5 æ³¨æ„åŠ›ä¸é›†ä¸­ (9é¡¹ï¼Œæˆäººéœ€â‰¥5)
                    if (q.category === 'æ³¨æ„åŠ›ä¸é›†ä¸­' && response === 'right') {
                        diagnosis.inattentiveScore++;
                    }
                    if (q.category === 'æ³¨æ„åŠ›ä¸é›†ä¸­' && response === 'up') {
                        diagnosis.inattentiveScore += 2; // ä¸Šæ»‘ç®—2ä¸ª
                    }

                    // DSM-5 å¤šåŠ¨-å†²åŠ¨ (9é¡¹ï¼Œæˆäººéœ€â‰¥5)
                    if (q.category === 'å¤šåŠ¨-å†²åŠ¨' && response === 'right') {
                        diagnosis.hyperactiveScore++;
                    }
                    if (q.category === 'å¤šåŠ¨-å†²åŠ¨' && response === 'up') {
                        diagnosis.hyperactiveScore += 2;
                    }

                    // ç—…ç¨‹è¦æ±‚
                    if (q.category === 'ç—…ç¨‹è¦æ±‚') {
                        if (q.id === 19 && response === 'right') diagnosis.durationMet = true;
                        if (q.id === 20 && response === 'right') diagnosis.onsetMet = true;
                    }

                    // åŠŸèƒ½æŸå®³
                    if (q.category === 'åŠŸèƒ½æŸå®³' && response === 'right') {
                        diagnosis.impairment++;
                    }

                    // å®¶æ—å²
                    if (q.category === 'å®¶æ—å²' && response === 'right') {
                        diagnosis.familyHistory++;
                    }

                    // å…±ç—…ç­›æŸ¥
                    if (q.category === 'å…±ç—…ç­›æŸ¥' && response === 'right') {
                        diagnosis.comorbidities.push(q.question.substring(0, 10) + '...');
                    }

                    // æ’é™¤æ ‡å‡†ï¼ˆå¦‚æœå›ç­”"æ˜¯"åˆ™æ’é™¤æ ‡å‡†ä¸æ»¡è¶³ï¼‰
                    if (q.category === 'æ’é™¤æ ‡å‡†' && response === 'right') {
                        diagnosis.exclusionsMet = false;
                    }
                }
            });

            // æ ¹æ®DSM-5æ ‡å‡†ç¡®å®šäºšå‹
            const inattentiveMet = diagnosis.inattentiveScore >= 5;
            const hyperactiveMet = diagnosis.hyperactiveScore >= 5;

            if (inattentiveMet && hyperactiveMet) {
                diagnosis.subtype = 'æ··åˆå‹ADHD';
                diagnosis.confidence = Math.min(100, (diagnosis.inattentiveScore + diagnosis.hyperactiveScore) / 18 * 100);
            } else if (inattentiveMet) {
                diagnosis.subtype = 'æ³¨æ„åŠ›ç¼ºé™·å‹ADHD';
                diagnosis.confidence = Math.min(100, diagnosis.inattentiveScore / 9 * 100);
            } else if (hyperactiveMet) {
                diagnosis.subtype = 'å¤šåŠ¨-å†²åŠ¨å‹ADHD';
                diagnosis.confidence = Math.min(100, diagnosis.hyperactiveScore / 9 * 100);
            }

            // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
            diagnosis.report = generateDiagnosisReport(diagnosis, categoryScores);

            return diagnosis;
        }

        function generateDiagnosisReport(diagnosis, categoryScores) {
            let report = [];

            // è¯Šæ–­ç»“è®º
            if (diagnosis.subtype) {
                report.push(`ğŸ“‹ è¯Šæ–­ï¼š${diagnosis.subtype}`);
                report.push(`ğŸ“Š åŒ¹é…åº¦ï¼š${diagnosis.confidence.toFixed(0)}%`);
            } else {
                report.push(`ğŸ“‹ è¯Šæ–­ï¼šä¸ç¬¦åˆADHDè¯Šæ–­æ ‡å‡†`);
                report.push(`ğŸ“Š åŒ¹é…åº¦ï¼š${diagnosis.confidence.toFixed(0)}%`);
            }

            // DSM-5 ç—‡çŠ¶æ»¡è¶³æƒ…å†µ
            report.push('');
            report.push('ğŸ“Œ DSM-5 ç—‡çŠ¶è¯„ä¼°ï¼š');
            report.push(`  â€¢ æ³¨æ„åŠ›ä¸é›†ä¸­ï¼š${diagnosis.inattentiveScore}/9é¡¹ ${diagnosis.inattentiveScore >= 5 ? 'âœ“' : 'âœ—'}`);
            report.push(`  â€¢ å¤šåŠ¨-å†²åŠ¨ï¼š${diagnosis.hyperactiveScore}/9é¡¹ ${diagnosis.hyperactiveScore >= 5 ? 'âœ“' : 'âœ—'}`);

            // ç—…ç¨‹è¦æ±‚
            report.push('');
            report.push('ğŸ“Œ ç—…ç¨‹è¦æ±‚ï¼š');
            report.push(`  â€¢ ç—‡çŠ¶æŒç»­6ä¸ªæœˆä»¥ä¸Šï¼š${diagnosis.durationMet ? 'âœ“' : 'âœ—'}`);
            report.push(`  â€¢ 12å²å‰å‡ºç°ï¼š${diagnosis.onsetMet ? 'âœ“' : 'âœ—'}`);

            // åŠŸèƒ½æŸå®³
            report.push('');
            report.push('ğŸ“Œ åŠŸèƒ½æŸå®³ï¼ˆâ‰¥1é¡¹æ»¡è¶³ï¼‰ï¼š');
            report.push(`  â€¢ å½±å“ç¨‹åº¦ï¼š${diagnosis.impairment}/4é¡¹ ${diagnosis.impairment >= 1 ? 'âœ“' : 'âœ—'}`);

            // æ’é™¤æ ‡å‡†
            report.push('');
            report.push('ğŸ“Œ æ’é™¤æ ‡å‡†ï¼š');
            report.push(`  â€¢ æ’é™¤å…¶ä»–åŸå› ï¼š${diagnosis.exclusionsMet ? 'âœ“' : 'âœ—'}`);

            // å®¶æ—å²
            if (diagnosis.familyHistory > 0) {
                report.push('');
                report.push(`ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶æ—å²ï¼š${diagnosis.familyHistory}ä½äº²å±æœ‰ADHDç—‡çŠ¶`);
            }

            // å…±ç—…ç­›æŸ¥
            if (diagnosis.comorbidities.length > 0) {
                report.push('');
                report.push(`ğŸ¥ å¯èƒ½å…±ç—…ï¼š${diagnosis.comorbidities.length}é¡¹éœ€å…³æ³¨`);
            }

            return report.join('\n');
        }

        function resetAssessment() {
            document.getElementById('start-view').style.display = 'flex';
            document.getElementById('card-view').style.display = 'none';
            document.getElementById('impact-view').style.display = 'none';
            document.getElementById('completion-view').style.display = 'none';
        }

        // ==================== Summary ====================
        function renderSummary() {
            const records = loadRecords();
            const record = records[0];

            const content = document.getElementById('summary-content');

            if (!record || !record.diagnosis) {
                content.innerHTML = `
                    <div class="history-empty">
                        <div class="history-empty-icon">ğŸ“‹</div>
                        <h3>æš‚æ— è®°å½•</h3>
                        <p>å®Œæˆè¯„ä¼°åï¼Œæ‚¨çš„è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                `;
                return;
            }

            const date = new Date(record.date);
            const dateStr = date.toLocaleDateString('zh-CN', { year: 'numeric', month: 'short', day: 'numeric' });

            // ==================== ç»Ÿè®¡50é“é¢˜çš„åˆ†ç±»å¾—åˆ† ====================
            const categoryScores = {};
            const allScores = {}; // A1-B9 è¯¦ç»†å¾—åˆ†

            // åˆå§‹åŒ–
            questions.forEach(q => {
                if (q.category !== 'å½±å“ç¨‹åº¦') {
                    categoryScores[q.category] = 0;
                }
            });

            // ç»Ÿè®¡æ¯ä¸ªé—®é¢˜çš„å›ç­”
            questions.forEach(q => {
                const response = responses[q.id];
                if (response === 'right' || response === 'up') {
                    const weight = response === 'up' ? 2 : 1;
                    if (q.category !== 'å½±å“ç¨‹åº¦') {
                        categoryScores[q.category] = (categoryScores[q.category] || 0) + weight;
                    }

                    // A1-B9 è¯¦ç»†å¾—åˆ†
                    if (q.id >= 1 && q.id <= 18) {
                        const code = q.id <= 9 ? 'A' + q.id : 'B' + (q.id - 9);
                        allScores[code] = { val: weight, question: q.question, desc: q.desc };
                    }
                }
            });

            // é›·è¾¾å›¾6ç»´åº¦
            const dimScores = {
                'æ³¨æ„åŠ›ä¸é›†ä¸­': categoryScores['æ³¨æ„åŠ›ä¸é›†ä¸­'] || 0,
                'å¤šåŠ¨-å†²åŠ¨': categoryScores['å¤šåŠ¨-å†²åŠ¨'] || 0,
                'ç—…ç¨‹': (record.diagnosis.durationMet ? 1 : 0) + (record.diagnosis.onsetMet ? 1 : 0),
                'åŠŸèƒ½æŸå®³': record.diagnosis.impairment || 0,
                'å®¶æ—å²': record.diagnosis.familyHistory || 0,
                'æˆäººè¡¨ç°': record.diagnosis.comorbidities?.length || 0
            };

            // ==================== æå–TOP 3 ç—›ç‚¹ï¼ˆä¸Šæ»‘=æä¸¥é‡ï¼‰====================
            const painPoints = [];
            questions.forEach(q => {
                const response = responses[q.id];
                // åªæå–"ä¸Šæ»‘"(æä¸¥é‡)çš„é¢˜ç›®
                if (response === 'up') {
                    painPoints.push({ question: q.question, desc: q.desc, category: q.category, weight: 2 });
                } else if (response === 'right') {
                    // å³ä¾§ï¼ˆæœ‰ï¼‰çš„ä½œä¸ºæ¬¡ä¼˜å…ˆçº§
                    if (q.category === 'æ³¨æ„åŠ›ä¸é›†ä¸­' || q.category === 'å¤šåŠ¨-å†²åŠ¨') {
                        painPoints.push({ question: q.question, desc: q.desc, category: q.category, weight: 1 });
                    }
                }
            });
            // æŒ‰æƒé‡æ’åºï¼Œå–å‰3ä¸ª
            const top3Pain = painPoints.sort((a, b) => b.weight - a.weight).slice(0, 3);

            // ==================== ç”Ÿæˆé›·è¾¾å›¾ ====================
            const radarWidth = 280;
            const radarHeight = 280;
            const centerX = radarWidth / 2;
            const centerY = radarHeight / 2;
            const radius = 100;

            const dimensions = [
                { label: 'æ³¨æ„åŠ›', value: dimScores['æ³¨æ„åŠ›ä¸é›†ä¸­'], max: 9 },
                { label: 'å¤šåŠ¨', value: dimScores['å¤šåŠ¨-å†²åŠ¨'], max: 9 },
                { label: 'ç—…ç¨‹', value: dimScores['ç—…ç¨‹'], max: 2 },
                { label: 'åŠŸèƒ½', value: dimScores['åŠŸèƒ½æŸå®³'], max: 4 },
                { label: 'å®¶æ—', value: dimScores['å®¶æ—å²'], max: 4 },
                { label: 'æˆäºº', value: dimScores['æˆäººè¡¨ç°'], max: 8 }
            ];

            const maxValue = 10;
            const angleStep = (2 * Math.PI) / dimensions.length;

            let points = '';
            let labels = '';

            dimensions.forEach((dim, i) => {
                const angle = i * angleStep - Math.PI / 2;
                // å½’ä¸€åŒ–åˆ°0-10
                const normalizedValue = (dim.value / dim.max) * 10;
                const value = Math.min(normalizedValue, maxValue);
                const x = centerX + Math.cos(angle) * (radius * value / maxValue);
                const y = centerY + Math.sin(angle) * (radius * value / maxValue);
                points += `${x},${y} `;

                const labelX = centerX + Math.cos(angle) * (radius + 25);
                const labelY = centerY + Math.sin(angle) * (radius + 25);
                labels += `<text x="${labelX}" y="${labelY}" text-anchor="middle" fill="#64748B" font-size="12">${dim.label}</text> `;
            });

            // ==================== DSM-5è¯æ®æ‘˜è¦ï¼ˆåŠ¨æ€é¢œè‰²ï¼‰====================
            let evidenceHTML = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">';
            // Aç»„ (æ³¨æ„åŠ›ä¸é›†ä¸­) 1-9
            for (let i = 1; i <= 9; i++) {
                const code = 'A' + i;
                const s = allScores[code];
                const val = s ? s.val : 0;
                const isPositive = val > 0;
                const isSevere = val === 2;
                evidenceHTML += `<div style="padding: 8px 12px; background: ${isSevere ? '#ef4444' : isPositive ? 'rgba(239,68,68,0.2)' : '#f1f5f9'}; border-radius: 6px; font-size: 12px; ${isSevere ? 'color: white;' : ''}">
                    <span style="font-weight: 700;">A${i}</span>
                    <span style="margin-left: 4px;">${isSevere ? 'â˜…â˜…' : isPositive ? 'â˜…' : 'â˜†'}</span>
                </div>`;
            }
            // Bç»„ (å¤šåŠ¨-å†²åŠ¨) 1-9
            for (let i = 1; i <= 9; i++) {
                const code = 'B' + i;
                const s = allScores[code];
                const val = s ? s.val : 0;
                const isPositive = val > 0;
                const isSevere = val === 2;
                evidenceHTML += `<div style="padding: 8px 12px; background: ${isSevere ? '#f59e0b' : isPositive ? 'rgba(245,158,11,0.2)' : '#f1f5f9'}; border-radius: 6px; font-size: 12px; ${isSevere ? 'color: white;' : ''}">
                    <span style="font-weight: 700;">B${i}</span>
                    <span style="margin-left: 4px;">${isSevere ? 'â˜…â˜…' : isPositive ? 'â˜…' : 'â˜†'}</span>
                </div>`;
            }
            evidenceHTML += '</div>';

            // ==================== æ¸²æŸ“ç•Œé¢ ====================
            content.innerHTML = `
                <!-- A4æŠ¥å‘Šå¡ç‰‡ -->
                <div id="a4-report" style="background: white; padding: 32px; margin: -20px; min-height: calc(100vh - 180px); max-width: 800px; margin-left: auto; margin-right: auto;">

                    <!-- å¤´éƒ¨ -->
                    <div style="border-bottom: 3px solid #1e293b; padding-bottom: 16px; margin-bottom: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h1 style="font-size: 28px; font-weight: 800; color: #1e293b; margin: 0; letter-spacing: 2px;">ADHD è¯„ä¼°æŠ¥å‘Š</h1>
                                <p style="color: #64748B; font-size: 14px; margin-top: 4px;">${dateStr}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 32px; font-weight: 800; color: ${record.diagnosis.subtype ? '#6366F1' : '#10B981'};">
                                    ${record.diagnosis.subtype ? record.diagnosis.subtype.replace('ADHD','') : 'æ­£å¸¸'}
                                </div>
                                <div style="font-size: 12px; color: #64748B;">${record.diagnosis.subtype ? 'åŒ¹é…åº¦ ' + record.diagnosis.confidence.toFixed(0) + '%' : ''}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 1. é›·è¾¾å›¾ -->
                    <div style="margin-bottom: 32px;">
                        <h3 style="font-size: 13px; font-weight: 600; color: #1e293b; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 2px; border-left: 3px solid #6366F1; padding-left: 12px;">ç»´åº¦è¯„ä¼°</h3>
                        <div style="display: flex; justify-content: center;">
                            <svg width="${radarWidth}" height="${radarHeight}" viewBox="0 0 ${radarWidth} ${radarHeight}">
                                ${[0.25, 0.5, 0.75, 1].map(r => `
                                    <polygon points="${dimensions.map((_, i) => {
                                        const angle = i * angleStep - Math.PI / 2;
                                        return (centerX + Math.cos(angle) * (radius * r)) + ',' + (centerY + Math.sin(angle) * (radius * r));
                                    }).join(' ')}" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                                `).join('')}
                                ${dimensions.map((_, i) => {
                                    const angle = i * angleStep - Math.PI / 2;
                                    return `<line x1="${centerX}" y1="${centerY}" x2="${centerX + Math.cos(angle) * radius}" y2="${centerY + Math.sin(angle) * radius}" stroke="#e2e8f0" stroke-width="1"/>`;
                                }).join('')}
                                <polygon points="${points}" fill="rgba(99, 102, 241, 0.25)" stroke="#6366F1" stroke-width="2"/>
                                ${labels}
                            </svg>
                        </div>
                    </div>

                    <!-- 2. DSM-5è¯æ®æ‘˜è¦ -->
                    <div style="margin-bottom: 32px;">
                        <h3 style="font-size: 13px; font-weight: 600; color: #1e293b; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 2px; border-left: 3px solid #6366F1; padding-left: 12px;">DSM-5 è¯æ®æ‘˜è¦ <span style="font-weight: 400; font-size: 11px; color: #64748B; text-transform: none; letter-spacing: 0;">(â˜…é˜³æ€§ â˜…â˜…æä¸¥é‡)</span></h3>
                        <div style="display: flex; gap: 16px; margin-bottom: 12px; font-size: 12px; color: #64748B;">
                            <span>ğŸ”´ Aç»„(æ³¨æ„åŠ›ä¸é›†ä¸­): ${record.diagnosis.inattentiveScore}/9</span>
                            <span>ğŸŸ  Bç»„(å¤šåŠ¨-å†²åŠ¨): ${record.diagnosis.hyperactiveScore}/9</span>
                        </div>
                        ${evidenceHTML}
                    </div>

                    <!-- 3. Top 3 Pain Points -->
                    <div style="margin-bottom: 32px;">
                        <h3 style="font-size: 13px; font-weight: 600; color: #1e293b; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 2px; border-left: 3px solid #ef4444; padding-left: 12px;">æ ¸å¿ƒç—›ç‚¹ (Top 3)</h3>
                        ${top3Pain.length > 0 ? top3Pain.map((p, i) => `
                            <div style="padding: 14px 16px; background: ${p.weight === 2 ? '#fef2f2' : '#fff7ed'}; border-left: 4px solid ${p.weight === 2 ? '#ef4444' : '#f59e0b'}; border-radius: 0 8px 8px 0; margin-bottom: 8px;">
                                <div style="font-weight: 600; color: #1e293b; font-size: 14px;">${i + 1}. ${p.question.replace('ï¼Ÿ', '')}</div>
                                ${p.desc ? `<div style="color: #64748B; font-size: 12px; margin-top: 4px;">${p.desc}</div>` : ''}
                            </div>
                        `).join('') : '<p style="color: #64748B; font-size: 14px; padding: 12px; background: #f8fafc; border-radius: 8px;">æ— æ˜¾è‘—ç—›ç‚¹è®°å½•</p>'}
                    </div>

                    <!-- åº•éƒ¨æ“ä½œæ  -->
                    <div style="border-top: 1px solid #e2e8f0; padding-top: 16px; margin-top: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                            <p style="font-size: 11px; color: #94a3b8; max-width: 300px;">âš ï¸ æœ¬æŠ¥å‘Šä»…ä¾›ä¸´åºŠå‚è€ƒï¼Œéæœ€ç»ˆè¯Šæ–­ã€‚éœ€ä¸“ä¸šåŒ»å¸ˆç»¼åˆè¯„ä¼°åç¡®è¯Šã€‚</p>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="printA4Report()" style="padding: 10px 20px; background: #6366F1; color: white; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; font-weight: 500;">ğŸ–¨ï¸ æ‰“å°PDF</button>
                                <button onclick="copyA4Report()" style="padding: 10px 20px; background: #1e293b; color: white; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; font-weight: 500;">ğŸ“‹ å¤åˆ¶</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ‰“å°æ ·å¼ -->
                <style>
                    @media print {
                        body * { visibility: hidden; }
                        #a4-report, #a4-report * { visibility: visible; }
                        #a4-report {
                            position: absolute;
                            left: 0;
                            top: 0;
                            width: 100%;
                            margin: 0;
                            padding: 20px !important;
                            box-shadow: none;
                        }
                        .tab-nav { display: none !important; }
                    }
                </style>
            `;
        }

        function copyA4Report() {
            const records = loadRecords();
            const record = records[0];
            if (!record) return;

            const date = new Date(record.date);
            const dateStr = date.toLocaleDateString('zh-CN', { year: 'numeric', month: 'short', day: 'numeric' });

            // æå–ç—›ç‚¹ - åªå–ä¸Šæ»‘(æä¸¥é‡)çš„é¢˜ç›®
            const painPoints = [];
            questions.forEach(q => {
                const response = responses[q.id];
                if (response === 'up') {
                    painPoints.push({ q: q.question.replace('ï¼Ÿ', ''), w: 2 });
                } else if (response === 'right' && (q.category === 'æ³¨æ„åŠ›ä¸é›†ä¸­' || q.category === 'å¤šåŠ¨-å†²åŠ¨')) {
                    painPoints.push({ q: q.question.replace('ï¼Ÿ', ''), w: 1 });
                }
            });
            const top3 = painPoints.sort((a, b) => b.w - a.w).slice(0, 3);

            const report = `ã€ADHD è¯„ä¼°æŠ¥å‘Šã€‘${dateStr}

ã€è¯Šæ–­ã€‘${record.diagnosis.subtype || 'æ­£å¸¸'}
ã€åŒ¹é…åº¦ã€‘${record.diagnosis.confidence.toFixed(0)}%

ã€DSM-5è¯æ®ã€‘
Aç»„(æ³¨æ„åŠ›ä¸é›†ä¸­): ${record.diagnosis.inattentiveScore}/9
Bç»„(å¤šåŠ¨-å†²åŠ¨): ${record.diagnosis.hyperactiveScore}/9
ç—…ç¨‹: ${record.diagnosis.durationMet ? 'âœ“' : 'âœ—'} æŒç»­6æœˆ+ | ${record.diagnosis.onsetMet ? 'âœ“' : 'âœ—'} 12å²å‰å‡ºç°
åŠŸèƒ½æŸå®³: ${record.diagnosis.impairment}/4é¡¹
å®¶æ—å²: ${record.diagnosis.familyHistory}ä½äº²å±

ã€æ ¸å¿ƒç—›ç‚¹ã€‘(ä¸Šæ»‘é¢˜ç›®)
${top3.map((p, i) => `${i+1}. ${p.q}`).join('\n') || 'æ— '}

---
âš ï¸ æœ¬æŠ¥å‘Šä»…ä¾›ä¸´åºŠå‚è€ƒï¼Œéæœ€ç»ˆè¯Šæ–­ã€‚éœ€ä¸“ä¸šåŒ»å¸ˆç¡®è¯Šã€‚`;

            navigator.clipboard.writeText(report).then(() => {
                alert('æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function printA4Report() {
            window.print();
        }

        function selectDuration(id) {
            selectedDuration = id;
            renderSummary();
        }

        // ==================== History ====================
        function renderHistory() {
            const records = loadRecords();
            const content = document.getElementById('history-content');

            if (records.length === 0) {
                content.innerHTML = `
                    <div class="history-empty">
                        <div class="history-empty-icon">ğŸ“‹</div>
                        <h3>æš‚æ— å†å²è®°å½•</h3>
                        <p>å®Œæˆè¯„ä¼°åï¼Œæ‚¨çš„è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                `;
                return;
            }

            content.innerHTML = `
                <div class="history-list">
                    ${records.map(r => {
                        const date = new Date(r.date);
                        const dateStr = date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                        const timeStr = date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });

                        const severityEmoji = r.severity <= 3 ? 'ğŸŸ¢' : r.severity <= 6 ? 'ğŸŸ¡' : r.severity <= 8 ? 'ğŸŸ ' : 'ğŸ”´';
                        const severityText = r.severity <= 3 ? 'è½»å¾®' : r.severity <= 6 ? 'ä¸­ç­‰' : r.severity <= 8 ? 'ä¸¥é‡' : 'æä¸¥é‡';

                        const duration = durations.find(d => d.id === r.duration);

                        return `
                            <div class="history-item">
                                <div class="history-item-header">
                                    <span class="history-date">${dateStr}</span>
                                    <span class="history-severity">${severityEmoji} ${severityText}</span>
                                </div>
                                <p class="history-summary">${r.summary}</p>
                                <div class="history-symptoms">
                                    ${r.symptoms.slice(0, 3).map(s => `
                                        <span class="history-symptom">${s.emoji} ${s.name}</span>
                                    `).join('')}
                                    ${r.symptoms.length > 3 ? `<span class="history-symptom">+${r.symptoms.length - 3}</span>` : ''}
                                </div>
                                ${duration ? `<p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">${duration.emoji} ${duration.text}</p>` : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
                <button class="history-clear" onclick="confirmClearHistory()">æ¸…ç©ºå†å²è®°å½•</button>
            `;
        }

        function confirmClearHistory() {
            showAlert('æ¸…ç©ºå†å²è®°å½•', 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚', () => {
                saveRecords([]);
                renderHistory();
            });
        }

        // ==================== Settings ====================
        function confirmReset() {
            showAlert('é‡ç½®æ•°æ®', 'ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰å†å²è®°å½•ã€‚', () => {
                localStorage.removeItem('adhd_records');
                resetAssessment();
                switchTab('home');
            });
        }

        // ==================== Alert ====================
        let alertCallback = null;

        function showAlert(title, message, callback) {
            document.getElementById('alert-title').textContent = title;
            document.getElementById('alert-message').textContent = message;
            document.getElementById('alert').classList.add('show');
            alertCallback = callback;
        }

        function closeAlert() {
            document.getElementById('alert').classList.remove('show');
        }

        // Close alert on background click
        document.getElementById('alert').addEventListener('click', (e) => {
            if (e.target.id === 'alert') closeAlert();
        });
    </script>
</body>
</html>
